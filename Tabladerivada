  SELECT *
    FROM 
    (
   SELECT  Cliente.idCli as cli,nomCli,apmCli,telCli,rcfCli
    ,DATEDIFF(fechVent,NOW()) AS diferencias_dias
    FROM Usuario 
    INNER JOIN Cliente ON(Usuario.IdUsu=Cliente.Usuario)
    INNER JOIN Venta ON(Venta.IdCli=Cliente.idCli)
    GROUP BY Cliente.idCli,nomCli,apmCli,telCli,rcfCli
     HAVING diferencias_dias<(365*5)
    )AS tabla2 where tabla2.diferencias_dias
   <=
    (
    SELECT max( tabla1.diferencias_dias) AS diferencias_dias
    FROM 
    (
   SELECT  Cliente.idCli as cli,nomCli,apmCli,telCli,rcfCli
    ,DATEDIFF(fechVent,NOW()) AS diferencias_dias
    FROM Usuario 
    INNER JOIN Cliente ON(Usuario.IdUsu=Cliente.Usuario)
    INNER JOIN Venta ON(Venta.IdCli=Cliente.idCli)
    GROUP BY Cliente.idCli
     HAVING diferencias_dias<=(365*5)
    )AS tabla1
    )  
    ;
    
    
    SELECT DISTINCT Usuario,PassUs,CorreoUs,nomCli,apmCli,telCli,rcfCli
from Cliente 
INNER JOIN Usuario on(Cliente.Usuario=Usuario.idUsu)

WHERE Usuario not in

(SELECT DISTINCT cli
from (

SELECT  cli,PassUs,CorreoUs,nomCli,apmCli,telCli,rcfCli
 from 
 (
SELECT DISTINCT Usuario as cli,PassUs,CorreoUs,nomCli,apmCli,telCli,rcfCli
from  Venta
INNER JOIN  Det_venta on(Det_venta.IdDetv=Venta.IdVent)
INNER JOIN Cliente on(Venta.IdCli=Cliente.idCli)
INNER JOIN Usuario on(Cliente.Usuario=Usuario.idUsu)

where Venta.IdVent  in 
(
SELECT DISTINCT Venta.IdVent from Det_venta
INNER JOIN  Venta on(Det_venta.IdDetv=Venta.IdVent)
)

 )as tabla1
)xd 
)
 ;


